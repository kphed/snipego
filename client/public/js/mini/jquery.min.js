"use strict";angular.module("SnipeGo",["SnipeGo.Directives.Popover","SnipeGo.Directives.ToggleClass","SnipeGo.MainCtrl","SnipeGo.NavCtrl","SnipeGo.DepositCtrl","SnipeGo.Services","ui.router","firebase","angular-svg-round-progress"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",views:{"":{templateUrl:"js/template/main.html",controller:"MainCtrl"},nav:{templateUrl:"js/template/nav.html",controller:"NavCtrl"}}})}]),angular.module("SnipeGo.DepositCtrl",["SnipeGo","SnipeGo.Services"]).controller("DepositCtrl",["$scope","$http","$rootScope","$window","$firebaseObject","$timeout",function(e,t,a,r,o,n){var s;e.users={};var i=function(){return{tradeUrl:a.user.tradeUrl,displayName:a.user.displayName,avatar:a.user.photos[1],id:a.user.id,items:e.selectedItems,itemsValue:e.totalValue(),itemsCount:a.itemsSelected}};e.inventoryLoading=!1,e.loadingTrade=!1,e.items=[],e.selectedItems={},e.tradeID="",e.protectionCode="",e.errorDetected=!1,e.setUser=function(){s=new Firebase("https://snipego.firebaseio.com/users/"+a.user.id),e.users=o(s),e.users.$watch(function(){e.users.$loaded().then(function(){void 0!==e.users.tradeID&&void 0!==e.users.protectionCode&&(e.tradeID=e.users.tradeID,e.protectionCode=e.users.protectionCode)})})},e.selectedQuantity=function(){return a.itemsSelected=Object.keys(e.selectedItems).length," "+a.itemsSelected+" Skins"},e.totalValue=function(){var t=0;for(var a in e.selectedItems)t+=parseFloat(e.selectedItems[a].market_price);return Math.round(100*t)/100},e.selectItem=function(t){e.selectedItems[t.assetid]?delete e.selectedItems[t.assetid]:10===a.itemsSelected?r.alert("You can't add more than 10 items"):e.selectedItems[t.assetid]=t},e.depositItems=function(){if(e.totalValue()<1)r.alert("You need at least $1 skins value to play, select more skins");else{if(e.setUser(),0===a.itemsSelected)return void r.alert("Please select at least one skin to deposit");e.loadingTrade=!0,t.post("/deposit/",i()).then(function(t){t.data.error&&r.alert(t.data.error),e.selectedItems={},e.items=[],e.loadingTrade=!1},function(t){e.errorDetected=!0,e.loadingTrade=!1,e.selectedItems={},e.items=[],n(function(){e.errorDetected=!1},5e3)})}},e.sortItems=function(t){e.items=t.sort(function(e,t){return t.market_price-e.market_price}),e.inventoryLoading=!1},e.fetchInventory=function(){e.selectedItems={},e.items=[],e.inventoryLoading?r.alert("Your inventory is already loading, please be patient"):(e.inventoryLoading=!0,t.post("/users/update-inventory",{steamid:a.user.id}).success(function(t){e.sortItems(t)}))}}]),angular.module("SnipeGo.MainCtrl",["SnipeGo"]).controller("MainCtrl",["$scope","$firebaseArray","$firebaseObject","$rootScope","$window","$http","$sce","$timeout",function(e,t,a,r,o,n,s,i){var l=new Firebase("https://snipego.firebaseio.com/currentJackpot"),c=new Firebase("https://snipego.firebaseio.com/endedJackpots");e.currentJackpot=a(l),e.endedJackpots=t(c),e.ended=[],e.twitchPlayer='<object bgcolor="#000000"data="//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf"height="250px"type="application/x-shockwave-flash"width="100%"><param name="allowFullScreen"value="true" /><param name="allowNetworking"value="all" /><param name="allowScriptAccess"value="always" /><param name="movie"value="//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf" /><param name="flashvars"value="channel=joshog&auto_play=true&start_volume=50" /></object><iframe frameborder="0" scrolling="no" id="chat_embed" src="http://www.twitch.tv/joshog/chat" height="325" width="100%"></iframe>',e.getTwitch=function(){var t="https://api.twitch.tv/kraken/streams?game=Counter-Strike%3A%20Global%20Offensive&limit=1&callback=JSON_CALLBACK";n.defaults.headers.common["X-Custom-Header"]="Angular.js",n.jsonp(t).success(function(t){var a=t.streams[0].channel.display_name;a=a.replace(/['"]+/g,""),i(function(){e.twitchPlayer='<object bgcolor="#000000"data="//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf"height="250px"type="application/x-shockwave-flash"width="100%"><param name="allowFullScreen"value="true" /><param name="allowNetworking"value="all" /><param name="allowScriptAccess"value="always" /><param name="movie"value="//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf" /><param name="flashvars"value="channel='+a+'&auto_play=true&start_volume=50" /></object><iframe frameborder="0" scrolling="no" id="chat_embed" src="http://www.twitch.tv/'+a.toLowerCase()+'/chat" height="325" width="100%"></iframe>'})})},e.getTwitch(),e.getHtml=function(e){return s.trustAsHtml(e)},e.currentJackpot.$watch(function(){e.currentJackpot.$loaded().then(function(){var t=[];for(var a in e.currentJackpot.players)e.currentJackpot.players[a].chance=(e.currentJackpot.players[a].itemsValue/e.currentJackpot.jackpotValue*100).toFixed(2),t.push(e.currentJackpot.players[a]);e.currentJackpot.jackpotValue=e.currentJackpot.jackpotValue.toFixed(2)})}),e.endedJackpots.$watch(function(){e.endedJackpots.$loaded().then(function(){e.ended=e.endedJackpots.slice(-3).reverse();for(var t=0;t<e.ended.length;t++){e.ended[t].winningNumber=(100*parseFloat(e.ended[t].rngStr)).toFixed(2)+"%";for(var a=0;a<e.ended[t].players.length;a++)e.ended[t].players[a].chance=(e.ended[t].players[a].itemsValue/e.ended[t].jackpotValue*100).toFixed(2)}})}),e.getSteam=function(){console.log("Calling get steam"),n.get("/users/get-steam").success(function(e){console.log("here is the steam data",e)})},e.getStyle=function(){var e="translateY(-50%) translateX(-50%)";return{top:"32%",bottom:"auto",left:"50%",transform:e,"-moz-transform":e,"-webkit-transform":e,"font-size":"100px"}}}]),angular.module("SnipeGo.NavCtrl",["SnipeGo","SnipeGo.Services"]).controller("NavCtrl",["$scope","$rootScope","Auth","$http","$firebaseObject",function(e,t,a,r,o){var n=new Firebase("https://snipego.firebaseio.com/dailyGiveaway");e.dailyGiveaway=o(n),e.successDanger="danger",e.isAuth=!1,e.tradeUrlSuccess=!1,e.profilePic="",e.tradeUrl="Add trade URL to unlock jackpot deposits",e.playDestination="#tradeurl",e.updateTradeUrl=function(){e.tradeUrl.match(/partner/i)&&e.tradeUrl.match(/token/i)?r.post("/users/update-trade-url",{tradeUrl:e.tradeUrl}).success(function(a){t.user.tradeUrl=e.tradeUrl,e.successDanger="success",e.playDestination="#deposit",e.tradeUrlSuccess=!0}):e.tradeUrl="Invalid trade Url, please try again"},e.clearPlaceholder=function(){e.tradeUrl=""},e.checkAuth=function(){a.checkSession().success(function(a){a&&(e.profilePic=a.photos[1],e.isAuth=!0,t.user=a,a.tradeUrl&&(e.successDanger="success",e.playDestination="#deposit"))})},e.checkAuth()}]),angular.module("SnipeGo.Directives.Popover",["SnipeGo"]).directive("popover",function(){return function(e,t,a){t.find("[rel=popover]").popover({placement:"bottom",html:"true"})}}),angular.module("SnipeGo.Directives.ToggleClass",["SnipeGo"]).directive("toggleClass",["$rootScope",function(e){return{restrict:"A",link:function(t,a,r){$(a).click(function(){e.itemsSelected<10?$(a).toggleClass("highlightSelected"):$(a).removeClass("highlightSelected")})}}}]),angular.module("SnipeGo.Services",["SnipeGo"]).factory("Auth",["$http",function(e){var t=function(){return e.get("/auth/is-authenticated")};return{checkSession:t}}]);