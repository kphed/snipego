"use strict";angular.module("SnipeGo",["SnipeGo.Directives.Popover","SnipeGo.Directives.ToggleClass","SnipeGo.MainCtrl","SnipeGo.NavCtrl","SnipeGo.DepositCtrl","SnipeGo.Services","ui.router","firebase","angular-svg-round-progress","irontec.simpleChat"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",views:{"":{templateUrl:"js/template/main.html",controller:"MainCtrl"},nav:{templateUrl:"js/template/nav.html",controller:"NavCtrl"}}})}]),angular.module("SnipeGo.DepositCtrl",["SnipeGo","SnipeGo.Services"]).controller("DepositCtrl",["$scope","$http","$rootScope","$window","$firebaseObject","$timeout",function(e,t,r,s,o,n){var a;e.users={};var i=function(){return{tradeUrl:r.user.tradeUrl,displayName:r.user.displayName,avatar:r.user.photos[1],id:r.user.id,items:e.selectedItems,itemsValue:e.totalValue(),itemsCount:r.itemsSelected}};e.inventoryLoading=!1,e.loadingTrade=!1,e.items=[],e.selectedItems={},e.tradeID="",e.protectionCode="",e.errorDetected=!1,e.setUser=function(){a=new Firebase("https://snipego.firebaseio.com/users/"+r.user.id),e.users=o(a),e.users.$watch(function(){e.users.$loaded().then(function(){void 0!==e.users.tradeID&&void 0!==e.users.protectionCode&&(e.tradeID=e.users.tradeID,e.protectionCode=e.users.protectionCode)})})},e.selectedQuantity=function(){return r.itemsSelected=Object.keys(e.selectedItems).length," "+r.itemsSelected+" Skins"},e.totalValue=function(){var t=0;for(var r in e.selectedItems)t+=parseFloat(e.selectedItems[r].market_price);return Math.round(100*t)/100},e.selectItem=function(t){e.selectedItems[t.assetid]?delete e.selectedItems[t.assetid]:10===r.itemsSelected?s.alert("You can't add more than 10 items"):e.selectedItems[t.assetid]=t},e.depositItems=function(){if(e.totalValue()<1)s.alert("You need at least $1 skins value to play, select more skins");else{if(e.setUser(),0===r.itemsSelected)return void s.alert("Please select at least one skin to deposit");e.loadingTrade=!0,t.post("/deposit/",i()).then(function(t){t.data.error&&s.alert(t.data.error),e.selectedItems={},e.items=[],e.loadingTrade=!1},function(t){e.errorDetected=!0,e.loadingTrade=!1,e.selectedItems={},e.items=[],n(function(){e.errorDetected=!1},5e3)})}},e.sortItems=function(t){e.items=t.sort(function(e,t){return t.market_price-e.market_price}),e.inventoryLoading=!1},e.fetchInventory=function(){e.selectedItems={},e.items=[],e.inventoryLoading?s.alert("Your inventory is already loading, please be patient"):(e.inventoryLoading=!0,t.post("/users/update-inventory",{steamid:r.user.id}).success(function(t){e.sortItems(t)}))}}]),angular.module("SnipeGo.MainCtrl",["SnipeGo"]).controller("MainCtrl",["$scope","$firebaseArray","$firebaseObject","$rootScope","$window","$http","$sce","$timeout",function(e,t,r,s,o,n,a,i){var c=new Firebase("https://snipego.firebaseio.com/currentJackpot"),l=new Firebase("https://snipego.firebaseio.com/endedJackpots"),u=new Firebase("https://snipego.firebaseio.com/messages");e.currentJackpot=r(c),e.endedJackpots=t(l),e.messages=t(u),e.ended=[],e.currentJackpot.$watch(function(){e.currentJackpot.$loaded().then(function(){var t=[];for(var r in e.currentJackpot.players)e.currentJackpot.players[r].chance=(e.currentJackpot.players[r].itemsValue/e.currentJackpot.jackpotValue*100).toFixed(2),t.push(e.currentJackpot.players[r]);e.currentJackpot.jackpotValue=e.currentJackpot.jackpotValue.toFixed(2)})}),e.endedJackpots.$watch(function(){e.endedJackpots.$loaded().then(function(){e.ended=e.endedJackpots.slice(-3).reverse();for(var t=0;t<e.ended.length;t++){e.ended[t].winningNumber=(100*parseFloat(e.ended[t].rngStr)).toFixed(2)+"%";for(var r=0;r<e.ended[t].players.length;r++)e.ended[t].players[r].chance=(e.ended[t].players[r].itemsValue/e.ended[t].jackpotValue*100).toFixed(2)}})}),e.getSteam=function(){console.log("Calling get steam"),n.get("/users/get-steam").success(function(e){console.log("here is the steam data",e)})},e.getStyle=function(){var e="translateY(-50%) translateX(-50%)";return{top:"33%",bottom:"auto",left:"50%",transform:e,"-moz-transform":e,"-webkit-transform":e,"font-size":"100px"}},e.sendMessage=function(e,t){if(console.log("Calling send message",e,t,s.user),e)if(s.user.id){var r={};r.message=e,r.username=t,s.user.staff&&(r.staff=s.user.staff),r.imageUrl=s.user.photos[0],n.post("/user/send-message",r).success(function(){console.log("Posted message successfully")})}else o.alert("Sign in to chat!");else o.alert("Enter in a message to chat!")}}]),angular.module("SnipeGo.NavCtrl",["SnipeGo","SnipeGo.Services"]).controller("NavCtrl",["$scope","$rootScope","Auth","$http","$firebaseObject",function(e,t,r,s,o){var n=new Firebase("https://snipego.firebaseio.com/dailyGiveaway");e.dailyGiveaway=o(n),e.successDanger="danger",e.isAuth=!1,e.tradeUrlSuccess=!1,e.profilePic="",e.tradeUrl="Add trade URL to unlock jackpot deposits",e.playDestination="#tradeurl",e.updateTradeUrl=function(){e.tradeUrl.match(/partner/i)&&e.tradeUrl.match(/token/i)?s.post("/users/update-trade-url",{tradeUrl:e.tradeUrl}).success(function(r){t.user.tradeUrl=e.tradeUrl,e.successDanger="success",e.playDestination="#deposit",e.tradeUrlSuccess=!0}):e.tradeUrl="Invalid trade Url, please try again"},e.clearPlaceholder=function(){e.tradeUrl=""},e.checkAuth=function(){r.checkSession().success(function(r){r&&(e.profilePic=r.photos[1],e.isAuth=!0,t.user=r,r.tradeUrl&&(e.successDanger="success",e.playDestination="#deposit"))})},e.checkAuth()}]),angular.module("SnipeGo.Directives.Popover",["SnipeGo"]).directive("popover",function(){return function(e,t,r){t.find("[rel=popover]").popover({placement:"bottom",html:"true"})}}),angular.module("SnipeGo.Directives.ToggleClass",["SnipeGo"]).directive("toggleClass",["$rootScope",function(e){return{restrict:"A",link:function(t,r,s){$(r).click(function(){e.itemsSelected<10?$(r).toggleClass("highlightSelected"):$(r).removeClass("highlightSelected")})}}}]),angular.module("SnipeGo.Services",["SnipeGo"]).factory("Auth",["$http",function(e){var t=function(){return e.get("/auth/is-authenticated")};return{checkSession:t}}]);